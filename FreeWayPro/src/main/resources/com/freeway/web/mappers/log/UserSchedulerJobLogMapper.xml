<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Mapper的配置信息 -->
<mapper namespace="com.freeway.web.mappers.log.UserSchedulerJobLogMapper">
    <resultMap id="userResultMap" type="UserSchedulerJobLog">
        <id property="logId" column="log_id" />
        <result property="logDate" column="log_date" javaType="java.sql.Timestamp"/>
        <result property="owner" column="owner" />
        <result property="jobName" column="job_name" />
        <result property="jobClass" column="job_class" />
        <result property="operation" column="operation" />
        <result property="status" column="status" />
        <result property="additionalInfo" column="additional_info" />
    </resultMap>
    
    <!-- query condition -->
    <sql id="where_clause">
        WHERE  REGEXP_LIKE(lower(a.job_name), #{jobObjName})
               AND to_char(a.log_date, 'yyyy/mm/dd') >= #{beginDate} 
               AND #{endDate} >= to_char(a.log_date, 'yyyy/mm/dd')
    </sql>

    <!-- 作业计划执行日志 -->
    <select id="findByCondition" resultMap="userResultMap"
        parameterType="ConditionFiled">
         SELECT * FROM (
             SELECT a.*, row_number() OVER (ORDER BY a.log_date DESC) rn 
             FROM   user_scheduler_job_log a
             <include refid="where_clause"></include>
         )
         WHERE rn > #{start} and #{limit} >= rn
    </select>
    <!-- 作业计划执行日志 -->
    <select id="selectCount" resultType="Integer" parameterType="ConditionFiled">
         SELECT COUNT(log_id) 
         FROM   user_scheduler_job_log 
             <include refid="where_clause"></include>
    </select>
</mapper>